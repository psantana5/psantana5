name: Find Largest Repositories by Commits

on:
  schedule:
    - cron: "0 0 * * *" # Runs daily at midnight
  workflow_dispatch:

jobs:
  find-largest-repos:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: "14"

      - name: Install dependencies
        run: npm install axios

      - name: Fetch Repositories
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          node -e '
          const axios = require("axios");
          const token = process.env.GITHUB_TOKEN;
          axios.get("https://api.github.com/users/psantana5/repos", {
            headers: { Authorization: `token ${token}` }
          }).then(async response => {
            const repos = response.data;
            const commitCounts = await Promise.all(repos.map(async repo => {
              const commits = await axios.get(repo.commits_url.replace("{/sha}", ""), {
                headers: { Authorization: `token ${token}` }
              });
              return { name: repo.name, commits: commits.data.length };
            }));
            const largestRepos = commitCounts.sort((a, b) => b.commits - a.commits).slice(0, 3);
            console.log("Largest Repositories by Commits:", largestRepos.map(repo => repo.name));
          }).catch(error => console.error(error));'
